<html ng-app="TechTalkMessageBoard">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" integrity="sha384-MIwDKRSSImVFAZCVLtU0LMDdON6KVCrZHyVQQj6e8wIEJkW4tvwqXrbMIya1vriY" crossorigin="anonymous">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css">
  </head>
  <body>
    <application-root></application-root>
  </body>
  <script>
    angular.module('TechTalkMessageBoard', [])
    .service('MessageService', function($q){
      this.getMessagesFromServer = function(){
        var deferred = $q.defer();
        deferred.resolve([
          { sender: 'User1', subject: 'Message 1', body: "This is the first message for sure" },
          { sender: 'User2', subject: 'Message 2', body: "This is the second message for sure" },
          { sender: 'User1', subject: 'Message 3', body: "I'm still sending you messages!"},
        ]);
        return deferred.promise;
      };
    })
    .directive('applicationRoot', function(){
      return {
        restrict: 'E',
        template: ''+
          '<div><header-bar login-status="loginStatus" current-view="currentView"></header-bar><message-search></message-search><message-list messages="messages"/></message-list></div>',
        link: function(scope){
          scope.messages = [
            { sender: 'User1', subject: 'Message 1', body: "This is the first message for sure" },
            { sender: 'User2', subject: 'Message 2', body: "This is the second message for sure" },
            { sender: 'User1', subject: 'Message 3', body: "I'm still sending you messages!"},
          ];

          scope.loginStatus = 'Logged In';
          scope.currentView = 'Messages';
        }
      };
    })
    .directive('headerBar', function(){
      return {
        restrict: 'E',
        scope: {
          user: '=',
          loginStatus: '=',
          currentView: '='
        },
        template: '' +
          '<nav class="navbar navbar-light bg-faded">'+
          '  <div class="nav navbar-nav">'+
          '    <a class="nav-item nav-link active" href="#">Pivotal Messanger <span class="sr-only">(current)</span></a>'+
          '    <login-link login-status="loginStatus"></login-link>'+
          '    <message-view-toggle-link current-view="currentView"></message-view-toggle-link>' +
          '  </div>'+
          '</nav>',
        link: function(scope){}
      };
    })
    .directive('loginLink', function(){
      return {
        restrict: 'E',
        scope: { loginStatus: '=' },
        replace: true,
        template: '' +
          '<a class="nav-item nav-link href="#">{{ loginStatus }}</a>',
      };
    })
    .directive('messageViewToggleLink', function(){
      return {
        restrict: 'E',
        scope: { currentView: '=' },
        replace: true,
        template: '' +
          '<a class="nav-item nav-link" href="#">{{ currentView }}</a>'
      };
    })
    .directive('messageList', function(){
      return {
        restrict: 'E',
        scope: { messages: '=' },
        template: ''+
          '<ul class="list-group"><message message="message" ng-repeat="message in messages track by $index" /></ul>'
      };
    })
    .directive('message', function(){
      return {
        restrict: 'E',
        scope: { message: '=' },
        replace: true,
        template: '' +
          '<li class="list-group-item"><h5 class="list-group-item-heading">{{ message.subject }}</h5><p class="list-group-item-text"><span>{{ message.body }}</span><span class="pull-lg-right pull-md-right"><reply-button user="message.sender"></reply-button></span></p></li>'
      };
    })
    .directive('replyButton', function(){
      return {
        restrict: 'E',
        scope: { user: '=' },
        replace: true,
        template: '' +
          '<button class="btn btn-default">Reply to {{ user }}</button>'
      };
    })
    .directive('messageSearch', function(){
      return {
        restrict: 'E',
        scope: {},
        replace: true,
        template: '' +
         '<div class="input-group input-group-lg">'+
         '  <input type="text" class="form-control" placeholder="message containing...">'+
         '</div>'
      };
    })
  </script>
</html>
